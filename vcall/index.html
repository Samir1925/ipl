<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Family Video Call</title>
</head>
  <style>
body { margin:0; font-family: Arial; background:#f5f5f5; }
header { background:#2d89ef; color:white; text-align:center; padding:15px; font-size:24px; }
#welcome { display:flex; flex-direction:column; align-items:center; justify-content:center; height:80vh; }
input { padding:10px; font-size:16px; margin:5px; }
button { padding:15px 30px; font-size:20px; border:none; border-radius:8px; background:#2d89ef; color:white; cursor:pointer; }
button:hover { background:#1b5dab; }
#videos { display:flex; flex-direction:column; align-items:center; }
video { width:300px; height:200px; margin:5px; border-radius:8px; background:black; }
</style>

<body>
<header>üë®‚Äçüë©‚Äçüëß Family Video Call</header>

<div id="welcome">
  <h2>Welcome to Family Video Call</h2>
  <p>Enter your name and join the call:</p>
  <input type="text" id="nameInput" placeholder="Your name">
  <button id="joinBtn">Join Call</button>
</div>

<div id="videos" style="display:none">
  <video id="localVideo" autoplay muted></video>
  <div id="remoteVideos"></div>
</div>

<script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
<script>
  const joinBtn = document.getElementById("joinBtn");
const nameInput = document.getElementById("nameInput");
const welcomeDiv = document.getElementById("welcome");
const videosDiv = document.getElementById("videos");
const localVideo = document.getElementById("localVideo");
const remoteVideos = document.getElementById("remoteVideos");

let localStream;
let peers = {};

// Use PeerJS cloud server
const peer = new Peer(undefined, { host:'peerjs.com', port:443, secure:true });

peer.on('open', id => console.log('My Peer ID:', id));

joinBtn.onclick = async () => {
  if(!nameInput.value) { alert("Enter your name"); return; }
  welcomeDiv.style.display = "none";
  videosDiv.style.display = "block";

  localStream = await navigator.mediaDevices.getUserMedia({video:true, audio:true});
  localVideo.srcObject = localStream;

  // When someone calls you
  peer.on('call', call => {
    call.answer(localStream);
    const remoteVideo = document.createElement("video");
    remoteVideo.autoplay = true;
    call.on('stream', remoteStream => { remoteVideo.srcObject = remoteStream; });
    remoteVideos.appendChild(remoteVideo);
  });

  // Share your ID with family (or use a fixed room ID)
  const roomID = "FamilyRoomNepal2025";
  const yourCall = peer.connect(roomID);

  // Automatically call other peers in room
  yourCall.on('open', () => {
    // Broadcast your Peer ID to others
    yourCall.send(peer.id);
  });

  peer.on('connection', conn => {
    conn.on('data', peerId => {
      const call = peer.call(peerId, localStream);
      const remoteVideo = document.createElement("video");
      remoteVideo.autoplay = true;
      call.on('stream', remoteStream => { remoteVideo.srcObject = remoteStream; });
      remoteVideos.appendChild(remoteVideo);
    });
  });
};
</script>
</body>
</html>
