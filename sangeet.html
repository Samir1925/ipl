<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sangeet Music Player</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #6c5ce7;
      --primary-dark: #5649c0;
      --bg-color: #f8f9fa;
      --card-bg: #ffffff;
      --text-color: #2d3436;
      --text-secondary: #636e72;
      --border-color: #dfe6e9;
      --player-bg: #ffffff;
      --player-text: #2d3436;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .dark-mode {
      --primary-color: #a29bfe;
      --primary-dark: #8179e0;
      --bg-color: #121212;
      --card-bg: #1e1e1e;
      --text-color: #f5f6fa;
      --text-secondary: #b2bec3;
      --border-color: #2d3436;
      --player-bg: #1e1e1e;
      --player-text: #f5f6fa;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', 'Segoe UI', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: all 0.3s ease;
      min-height: 100vh;
      padding-bottom: 100px;
    }

    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 5%;
      background-color: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-color);
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 1000;
      transition: all 0.3s ease;
    }

    .dark-mode nav {
      background-color: rgba(30, 30, 30, 0.8);
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--primary-color);
    }

    .logo i {
      font-size: 1.3rem;
    }

    .search-bar {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 0.6;
      max-width: 500px;
    }

    .search-bar input {
      padding: 10px 15px;
      font-size: 0.9rem;
      border-radius: 25px;
      border: 1px solid var(--border-color);
      outline: none;
      width: 100%;
      background-color: var(--card-bg);
      color: var(--text-color);
      transition: all 0.3s ease;
    }

    .search-bar input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(108, 92, 231, 0.2);
    }

    .search-bar button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      min-width: 40px;
    }

    .search-bar button:hover {
      background-color: var(--primary-dark);
    }

    .toggle-mode {
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 1.2rem;
      cursor: pointer;
      margin-left: 10px;
      transition: all 0.3s ease;
    }

    .toggle-mode:hover {
      color: var(--primary-color);
    }

    .container {
      padding: 2rem 5%;
    }

    .results {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 25px;
      margin-top: 20px;
    }

    .song-card {
      background: var(--card-bg);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .song-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .dark-mode .song-card:hover {
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }

    .song-card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      transition: all 0.3s ease;
    }

    .song-card:hover img {
      opacity: 0.8;
    }

    .song-info {
      padding: 12px;
    }

    .song-info h3 {
      margin: 0 0 5px 0;
      font-size: 0.9rem;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .song-info p {
      margin: 0;
      font-size: 0.8rem;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .load-more {
      text-align: center;
      margin: 40px 0;
    }

    .load-more button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.2s ease;
      box-shadow: 0 4px 6px rgba(108, 92, 231, 0.2);
    }

    .load-more button:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(108, 92, 231, 0.3);
    }

    .player {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--player-bg);
      color: var(--player-text);
      display: flex;
      align-items: center;
      padding: 15px 5%;
      gap: 20px;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
      border-top: 1px solid var(--border-color);
      z-index: 999;
      display: none;
      transition: all 0.3s ease;
    }

    .player.active {
      display: flex;
    }

    .player-img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .player-info {
      flex-grow: 1;
      min-width: 0;
    }

    .player-info h4 {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .player-info p {
      margin: 5px 0 0 0;
      font-size: 0.8rem;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .player-controls {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .player-controls i {
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-color);
    }

    .player-controls i:hover {
      color: var(--primary-color);
      transform: scale(1.1);
    }

    .player-controls .play-pause {
      background-color: var(--primary-color);
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 8px rgba(108, 92, 231, 0.3);
      transition: all 0.2s ease;
    }

    .player-controls .play-pause:hover {
      background-color: var(--primary-dark);
      transform: scale(1.05);
    }

    audio {
      display: none;
    }

    .progress-container {
      position: absolute;
      top: -5px;
      left: 0;
      right: 0;
      height: 5px;
      background-color: var(--border-color);
    }

    .progress-bar {
      height: 100%;
      background-color: var(--primary-color);
      width: 0%;
      transition: width 0.1s linear;
    }

    @media (max-width: 768px) {
      nav {
        padding: 12px 5%;
      }
      
      .logo {
        font-size: 1.2rem;
      }
      
      .search-bar {
        flex: 1;
        margin-left: 10px;
      }
      
      .results {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
      }
      
      .player {
        padding: 10px 5%;
      }
      
      .player-info h4 {
        font-size: 0.9rem;
      }
      
      .player-controls {
        gap: 10px;
      }
    }

    @media (max-width: 480px) {
      .results {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      }
      
      .song-card img {
        height: 140px;
      }
      
      .player-img {
        width: 50px;
        height: 50px;
      }
    }
    .notification {
  position: fixed;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  background-color: var(--primary-color);
  color: white;
  padding: 10px 20px;
  border-radius: 5px;
  z-index: 1001;
  animation: fadeInOut 3s ease;
}

@keyframes fadeInOut {
  0% { opacity: 0; }
  10% { opacity: 1; }
  90% { opacity: 1; }
  100% { opacity: 0; }
}

.song-card.active {
  box-shadow: 0 0 0 2px var(--primary-color);
}

.load-more button:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.fa-spinner {
  margin-right: 5px;
}
  </style>
</head>
<body>
  <nav>
    <div class="logo"><i class="fas fa-music"></i> Sangeet</div>
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search for songs..." />
      <button onclick="searchSongs(true)"><i class="fas fa-search"></i></button>
      <button class="toggle-mode" onclick="toggleDarkMode()" title="Toggle Dark Mode">
        <i class="fas fa-moon"></i>
      </button>
    </div>
  </nav>
  
  <div class="container">
    <div class="results" id="results"></div>
    <div class="load-more">
      <button onclick="loadMore()">Load More</button>
    </div>
  </div>
  
  <div class="player" id="player">
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <img class="player-img" id="playerImg" src="" alt="Cover">
    <div class="player-info">
      <h4 id="playerTitle">No song selected</h4>
      <p id="playerArtist">Select a song to play</p>
    </div>
    <div class="player-controls">
      <i class="fas fa-step-backward" onclick="prevSong()"></i>
      <i class="fas fa-play play-pause" id="playPause" onclick="togglePlayPause()"></i>
      <i class="fas fa-step-forward" onclick="nextSong()"></i>
    </div>
    <audio id="audioPlayer" ontimeupdate="updateProgress()"></audio>
  </div>

  <script>
// Global variables
let currentPage = 1;
let isPlaying = false;
let currentSongIndex = -1;
let songsList = [];
let searchQuery = 'Hindi';
let isLoading = false;
const songsPerPage = 20; // Number of songs to load per page

// Initialize the app
window.onload = () => {
  searchSongs(true);
  checkDarkModePreference();
  setupEventListeners();
};

// Set up event listeners
function setupEventListeners() {
  const searchInput = document.getElementById('searchInput');

  // Search when Enter is pressed
  searchInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      searchSongs(true);
    }
  });

  // Load More button
  document.querySelector('.load-more button').addEventListener('click', loadMore);

  // Audio player event listeners
  const audioPlayer = document.getElementById('audioPlayer');
  audioPlayer.addEventListener('ended', nextSong);
  audioPlayer.addEventListener('error', () => {
    showNotification('Error playing song. Please try another one.');
  });
}

// Check user's dark mode preference
function checkDarkModePreference() {
  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    document.body.classList.add('dark-mode');
    document.querySelector('.toggle-mode i').classList.replace('fa-moon', 'fa-sun');
  }
}

// Toggle dark mode
function toggleDarkMode() {
  document.body.classList.toggle('dark-mode');
  const icon = document.querySelector('.toggle-mode i');
  if (document.body.classList.contains('dark-mode')) {
    icon.classList.replace('fa-moon', 'fa-sun');
  } else {
    icon.classList.replace('fa-sun', 'fa-moon');
  }
}

// Search songs function
async function searchSongs(initial = false) {
  if (isLoading) return;

  if (initial) {
    currentPage = 1;
    searchQuery = document.getElementById('searchInput').value || 'Hindi';
    songsList = [];
  }

  const resultsDiv = document.getElementById('results');
  if (initial) {
    resultsDiv.innerHTML = '<div class="loading">Loading songs...</div>';
    document.querySelector('.load-more button').disabled = false;
    document.querySelector('.load-more button').textContent = 'Load More';
  }

  isLoading = true;
  showLoading(true);

  try {
    const url = `https://jiosaavn-api-privatecvc2.vercel.app/search/songs?query=${encodeURIComponent(searchQuery)}&page=${currentPage}&limit=${songsPerPage}`;
    const res = await fetch(url);
    const data = await res.json();
    const songs = data?.data?.results;

    if (!songs || songs.length === 0) {
      if (initial) {
        resultsDiv.innerHTML = '<p class="no-results">No songs found. Try a different search.</p>';
      }
      document.querySelector('.load-more button').disabled = true;
      document.querySelector('.load-more button').textContent = 'No more songs';
      return;
    }

    const startIndex = songsList.length;
    songsList = [...songsList, ...songs];
    displaySongs(songs, startIndex);

    if (songs.length < songsPerPage) {
      document.querySelector('.load-more button').disabled = true;
      document.querySelector('.load-more button').textContent = 'No more songs';
    }
  } catch (err) {
    console.error('Error fetching songs:', err);
    if (initial) {
      resultsDiv.innerHTML = '<p class="error">Error loading songs. Please try again later.</p>';
    }
    showNotification('Failed to load songs. Please try again.');
  } finally {
    isLoading = false;
    showLoading(false);
  }
}

// Display songs in the results grid
function displaySongs(songs, startIndex = 0) {
  const resultsDiv = document.getElementById('results');

  if (currentPage === 1) {
    resultsDiv.innerHTML = '';
  }

  songs.forEach((song, i) => {
    const playable = song.downloadUrl?.pop()?.link;
    if (!playable) return;

    const actualIndex = startIndex + i;

    const card = document.createElement('div');
    card.className = 'song-card';
    if (currentSongIndex === actualIndex) {
      card.classList.add('active');
    }
    card.innerHTML = `
      <img src="${song.image[2].link}" alt="${song.name} cover art">
      <div class="song-info">
        <h3>${song.name}</h3>
        <p>${song.primaryArtists}</p>
      </div>
    `;
    card.onclick = () => {
      currentSongIndex = actualIndex;
      playSong(song.name, song.primaryArtists, song.image[2].link, playable);
      document.querySelectorAll('.song-card').forEach(c => c.classList.remove('active'));
      card.classList.add('active');
    };
    resultsDiv.appendChild(card);
  });
}

// Load more songs
function loadMore() {
  currentPage++;
  searchSongs(false);
}

// Play selected song
function playSong(title, artist, image, audioUrl) {
  document.getElementById('playerImg').src = image;
  document.getElementById('playerTitle').textContent = title;
  document.getElementById('playerArtist').textContent = artist;

  const audio = document.getElementById('audioPlayer');
  audio.src = audioUrl;
  audio.play()
    .then(() => {
      isPlaying = true;
      document.getElementById('playPause').className = 'fas fa-pause play-pause';
      document.getElementById('player').classList.add('active');
    })
    .catch(err => {
      console.error('Error playing song:', err);
      showNotification('Error playing song. Please try another one.');
    });
}

// Toggle play/pause
function togglePlayPause() {
  const audio = document.getElementById('audioPlayer');
  const playPauseBtn = document.getElementById('playPause');

  if (isPlaying) {
    audio.pause();
    playPauseBtn.className = 'fas fa-play play-pause';
  } else {
    audio.play();
    playPauseBtn.className = 'fas fa-pause play-pause';
  }
  isPlaying = !isPlaying;
}

// Update progress bar
function updateProgress() {
  const audio = document.getElementById('audioPlayer');
  const progressBar = document.getElementById('progressBar');
  const progress = (audio.currentTime / audio.duration) * 100;
  progressBar.style.width = `${progress}%`;
}

// Play next song
function nextSong() {
  if (songsList.length === 0 || currentSongIndex === -1) return;

  currentSongIndex = (currentSongIndex + 1) % songsList.length;
  const song = songsList[currentSongIndex];
  const playable = song.downloadUrl?.pop()?.link;

  if (playable) {
    playSong(song.name, song.primaryArtists, song.image[2].link, playable);
    document.querySelectorAll('.song-card').forEach(c => c.classList.remove('active'));
    document.querySelectorAll('.song-card')[currentSongIndex]?.classList.add('active');
  } else {
    nextSong(); // Skip to next if current isn't playable
  }
}

// Play previous song
function prevSong() {
  if (songsList.length === 0 || currentSongIndex === -1) return;

  currentSongIndex = (currentSongIndex - 1 + songsList.length) % songsList.length;
  const song = songsList[currentSongIndex];
  const playable = song.downloadUrl?.pop()?.link;

  if (playable) {
    playSong(song.name, song.primaryArtists, song.image[2].link, playable);
    document.querySelectorAll('.song-card').forEach(c => c.classList.remove('active'));
    document.querySelectorAll('.song-card')[currentSongIndex]?.classList.add('active');
  } else {
    prevSong(); // Skip to previous if current isn't playable
  }
}

// Helper functions
function showNotification(message) {
  const notification = document.createElement('div');
  notification.className = 'notification';
  notification.textContent = message;
  document.body.appendChild(notification);

  setTimeout(() => {
    notification.remove();
  }, 3000);
}

function showLoading(show) {
  const loadMoreBtn = document.querySelector('.load-more button');
  if (!loadMoreBtn) return;

  if (show) {
    loadMoreBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
    loadMoreBtn.disabled = true;
  } else {
    loadMoreBtn.textContent = 'Load More';
    loadMoreBtn.disabled = false;
  }
}
  </script>
</body>
</html>
